<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Adding Order</title>
<link rel="stylesheet" type="text/css" href="styles/bootstrap.css" />
<link rel="stylesheet" type="text/css" href="styles/bar.css" />
<script type="text/javascript" src="js/jquery-2.1.3.min.js"></script>
<script type="text/javascript">
	function order() {
		var formUrl = $("#order_form").attr("action");
		console.log(formUrl);
		var tableName = $("#tableName")[0].value;

		if (tableName == "") {
			alert("Please fill table name");
			return;
		}

		drawTableWithItems();
		
		$.ajax({
			url : 'rest/user/current',
			type : "GET",
			dataType : "text"
		}).always(function(data) {
			if (typeof data != 'undefined') {
				$("#user-holder").text(data);
			} else {
				$(".welcome-greeting").hide();
			}
		});
	});
		
	function drawTableWithItems() {
		$.ajax({
			url : 'rest/order/waiting',
			type : "GET",
			dataType : "json",
			success : function(data) {
				if (data != null) {
					renderTable(data);
				} else {
					alert("Access to items forbidden!");
					return;
				}
			}
		});
	}
	
	function renderTable(data) {
		$("#items_table tr").remove();
		var items = data.item;
		for (var i = 0; i < items.length; i++) {
			renderRow(items[i]);
		}
	}
	
		var data = {
			order : {
				tableNumber : username,
				itemName : password,
				count : email
			}
		}
		console.log(JSON.stringify(data));
		
		$.ajax({
			url : 'rest/order/order',
			type : "POST",
			contentType : "application/json;charset=UTF-8",
			data : JSON.stringify(data)
		}).success(function(data) {
			$("#order_form").attr("action", "index.html");
			$("#order_form").submit();
		}).fail(function(data) {
			$("#order_form").attr("action", "addOrder.html");
		});
	}

</script>
</head>
<body>
	<div align="left">
		<h2>
			<a href="index.html">Simple Bar Management</a>
		</h2>
	</div>
	<hr>
	<h1 align="center">
		<b>ORDERING</b>
	</h1>
	<div>
		<table id="orders_table" class="table">
			<tr>
				<th>Title</th>
				<th>Author</th>
				<th>ISBN</th>
				<th>Amount</th>
				<th>Action</th>
			</tr>
		</table>
	</div>


	<div class="login_register">
		<a href="addOrder.html" class="add_order_form">Add Order</a> <a
			href="addItem.html" class="add_item_form">Add Items</a> <a
			href="login.html" class="register_form"> Log in </a>
	</div>

	<form id="order_form" role="form" method="post">
		<div class="form-group">
			<label for="tableName">Table Number:</label> <input type="text"
				class="form-control" name="userName" id="userName" value="">
		</div>

		<div class="form-group">
			<label for="email">Count:</label> <input type="email"
				class="form-control" name="email" id="email" value="">
		</div>

		<button type="reset" class="btn btn-default" id="reset_register">Reset</button>
		<button type="button" onclick="order()" class="btn btn-default">Submit</button>
	</form>

</body>
</html>